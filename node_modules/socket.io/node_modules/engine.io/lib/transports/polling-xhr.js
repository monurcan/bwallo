var Polling=require("./polling");var Transport=require("../transport");var debug=require("debug")("engine:polling-xhr");module.exports=XHR;function XHR(a){Polling.call(this,a)}XHR.prototype.__proto__=Polling.prototype;XHR.prototype.onRequest=function(b){if("OPTIONS"==b.method){var a=b.res;var c=this.headers(b);c["Access-Control-Allow-Headers"]="Content-Type";a.writeHead(200,c);a.end()}else{Polling.prototype.onRequest.call(this,b)}};XHR.prototype.doWrite=function(d){var a=typeof d=="string";var f=a?"text/plain; charset=UTF-8":"application/octet-stream";var b=""+(a?Buffer.byteLength(d):d.length);var e={"Content-Type":f,"Content-Length":b};var c=this.req.headers["user-agent"];if(c&&(~c.indexOf(";MSIE")||~c.indexOf("Trident/"))){e["X-XSS-Protection"]="0"}this.res.writeHead(200,this.headers(this.req,e));this.res.end(d)};XHR.prototype.headers=function(a,b){b=b||{};if(a.headers.origin){b["Access-Control-Allow-Credentials"]="true";b["Access-Control-Allow-Origin"]=a.headers.origin}else{b["Access-Control-Allow-Origin"]="*"}this.emit("headers",b);return b};