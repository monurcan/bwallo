var Transport=require("../transport"),parser=require("engine.io-parser"),debug=require("debug")("engine:ws");module.exports=WebSocket;function WebSocket(b){Transport.call(this,b);var a=this;this.socket=b.websocket;this.socket.on("message",this.onData.bind(this));this.socket.once("close",this.onClose.bind(this));this.socket.on("error",this.onError.bind(this));this.socket.on("headers",function(c){a.emit("headers",c)});this.writable=true}WebSocket.prototype.__proto__=Transport.prototype;WebSocket.prototype.name="websocket";WebSocket.prototype.handlesUpgrades=true;WebSocket.prototype.supportsFraming=true;WebSocket.prototype.onData=function(a){debug('received "%s"',a);Transport.prototype.onData.call(this,a)};WebSocket.prototype.send=function(d){var b=this;for(var c=0,a=d.length;c<a;c++){parser.encodePacket(d[c],this.supportsBinary,function(e){debug('writing "%s"',e);b.writable=false;b.socket.send(e,function(f){if(f){return b.onError("write error",f.stack)}b.writable=true;b.emit("drain")})})}};WebSocket.prototype.doClose=function(a){debug("closing");this.socket.close();a&&a()};