var http=require("http"),debug=require("debug")("engine:core");exports.protocol=1;exports.Server=require("./server");exports.Socket=require("./socket");exports.Transport=require("./transport");exports.transports=require("./transports");exports.parser=require("engine.io-parser");exports.listen=function(a,b,d){if("function"==typeof b){d=b;b={}}var e=http.createServer(function(g,f){f.writeHead(501);f.end("Not Implemented")});e.listen(a,d);var c=exports.attach(e,b);c.httpServer=e;return c};exports.attach=function(h,c){var e=new exports.Server(c);var c=c||{};var g=(c.path||"/engine.io").replace(/\/$/,"");var f=(c.destroyUpgrade!==undefined)?c.destroyUpgrade:true;var b=c.destroyUpgradeTimeout||1000;g+="/";function a(i){return g==i.url.substr(0,g.length)}var d=h.listeners("request").slice(0);h.removeAllListeners("request");h.on("close",e.close.bind(e));h.on("request",function(n,m){if(a(n)){debug('intercepting request for path "%s"',g);e.handleRequest(n,m)}else{for(var k=0,j=d.length;k<j;k++){d[k].call(h,n,m)}}});if(~e.transports.indexOf("websocket")){h.on("upgrade",function(k,i,j){if(a(k)){e.handleUpgrade(k,i,j)}else{if(false!==c.destroyUpgrade){setTimeout(function(){if(i.writable&&i.bytesWritten<=0){return i.end()}},c.destroyUpgradeTimeout)}}})}return e};