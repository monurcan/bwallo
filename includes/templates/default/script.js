jQuery.fn.closestToOffset=function(c){var b=null,g,e=c.left,d=c.top,a,i,h,f;this.each(function(){g=$(this).offset();if((e>=g.left)&&(e<=g.right)&&(d>=g.top)&&(d<=g.bottom)){b=$(this);return false}var j=[[g.left,g.top],[g.right,g.top],[g.left,g.bottom],[g.right,g.bottom]];for(off in j){i=j[off][0]-e;h=j[off][1]-d;a=Math.sqrt((i*i)+(h*h));if(f===undefined||a<f){f=a;b=$(this)}}});return b};function colorToHex(b){if(b.substr(0,1)==="#"){return b}var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(b);var f=parseInt(e[2]);var d=parseInt(e[3]);var a=parseInt(e[4]);var c=a|(d<<8)|(f<<16);return e[1]+"#"+c.toString(16)}$(document).ready(function(){var d=$(".title").outerHeight();$(".fake_title").css("height",d);$(".title").animate({left:0});$(".title").click(function(){$(this).animate({left:"-9999px"})});$(".fake_title").click(function(){$(".title").animate({left:0})});var c;$(document).on("contextmenu",".post",function(a){$(".contextmenu").remove();if($(this).hasClass("editable")){$(this).append('<ul class="contextmenu" style="top: '+a.pageY+"; left: "+a.pageX+'; "><li onclick="article('+$(this).data("id")+"); $('.contextmenu').remove(); \">Aç</li><li onclick=\"$(this).dblclick(); $('.contextmenu').hide(1, function(){$(this).remove();}); \">Düzenle</li><li onclick=\"post_update("+$(this).data("id")+", 'same', 'same', 'front'); \">En öne getir</li><li onclick=\"post_update("+$(this).data("id")+", 'same', 'same', 'back'); \">En arkaya gönder</li><li onclick=\"$(this).parent().parent('.post').fadeOut(150, function(){$(this).remove(); post_delete("+$(this).data("id")+');}); ">Sil</li></div>').children(".contextmenu").fadeIn(200)}else{$(this).append('<ul class="contextmenu" style="top: '+a.pageY+"; left: "+a.pageX+'; "><li onclick="article('+$(this).data("id")+"); $('.contextmenu').remove(); \">Aç</li></div>").children(".contextmenu").fadeIn(200)}return false}).on("mousedown",".post.free.editable",function(j){if($(j.target).is("ul.short")||$(j.target).is("ul.short *")||$(j.target).is(".post.free.editable.editting")||$(j.target).is(".post.free.editable.editting *")||$(j.target).is(".post.free.editable .handle")){return}c=0;var i=0;var a=0;$(this).addClass("draggable").parents().on("mousemove",function(h){$(".draggable").offset({top:h.clientY-$(".draggable").outerHeight()/2,left:h.clientX-$(".draggable").outerWidth()/2})}).on("mouseup",function(h){if(c==0){i=$(".posts")[0].scrollHeight-$(".posts").height();a=$(".posts")[0].scrollWidth-$(".posts").width();if(a>0){post_update($(".draggable").data("id"),$(".draggable").offset().left+a,$(".draggable").offset().top)}else{if(i>0){post_update($(".draggable").data("id"),$(".draggable").offset().left,$(".draggable").offset().top+i)}else{if(i>0&&a>0){post_update($(".draggable").data("id"),$(".draggable").offset().top+a,$(".draggable").offset().top+i)}else{post_update($(".draggable").data("id"),$(".draggable").offset().left,$(".draggable").offset().top)}}}c=1}});j.preventDefault()}).on("mouseup",function(){$(".draggable").removeClass("draggable");$(".sortable").removeClass("sortable")}).on("mousedown",".post.free.editable .handle",function(i){var a=i.clientX;$(this).parent(".post").addClass("resizable");var h=$(".resizable").css("width");$(this).on("mousemove",function(j){if(j.clientX>a){h=j.clientX-$(".resizable").offset().left}else{h=-($(".resizable").offset().left-j.clientX)}$(".resizable").css("width",h-15)}).on("mouseup",function(){$(this).parent(".post").removeClass("resizable");if($(".post.editting").length>0){var j;if($(this).parent(".post").children(".subtitle").html()=="<br>"){j=""}else{j=$(this).parent(".post").children(".subtitle").html()}if(j==""&&$(this).parent(".post").children("h3").text().trim()==""){post_delete($(this).parent(".post").data("id"))}else{post_update($(this).parent(".post").data("id"),"same","same","same",$(this).parent(".post").css("width").replace("px",""),$(this).parent(".post").children("h3").text().trim(),j)}}else{post_update($(this).parent(".post").data("id"),"same","same","same",$(this).parent(".post").css("width").replace("px",""))}})}).on("click",function(h){if(!($(h.target).is(".contextmenu")||$(h.target).is(".contextmenu *"))){$(".contextmenu").fadeOut(150)}if(!($(h.target).is(".post.editting")||$(h.target).is(".post.editting *")||$(h.target).is("ul.settings span.prompt input"))){if($(".post.editting").length>0){var a;if($(".post.editting").children(".subtitle").html()=="<br>"){a=""}else{a=$(".post.editting").children(".subtitle").html()}if(a==""&&$(".post.editting").children("h3").text().trim()==""){post_delete($(".post.editting").data("id"))}else{post_update($(".post.editting").data("id"),"same","same","same","same",$(".post.editting").children("h3").text().trim(),a)}$(".post").removeClass("editting").children(".subtitle, h3").attr("contenteditable","false");$(".post ul.short").removeClass("editting").hide().children("li").show()}}if(!($(h.target).is(".post.editting .subtitle")||$(h.target).is(".post.editting .subtitle *")||$(h.target).is("ul.settings")||$(h.target).is("ul.settings *"))){$("ul.settings").hide()}}).on("contextmenu",function(a){if(!$(a.target).is(".post")&&!$(a.target).is(".post *")&&$(a.target).is(".posts")){$(".contextmenu").remove();$(".posts").append('<ul class="contextmenu" style="top: '+a.pageY+"; left: "+a.pageX+'; "><li><span><p>X</p></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></li></div>').children(".contextmenu").fadeIn(200);return false}else{$(".contextmenu").fadeOut(150)}}).on("click",".posts > ul.contextmenu li span",function(){var a=$(this).css("background-color");if(a=="rgb(255, 255, 255)"){$(".post").show()}else{$(".posts .post").each(function(){if($(this).css("border-bottom-color")!=a){$(this).hide()}else{$(this).show()}})}});var c;$(document).on("mouseover",".post.editable",function(){$("ul.short:not(.editting)").hide();$(this).children("ul.short").show()}).on("mouseout",".post.editable",function(){$("ul.short:not(.editting)").hide()}).on("dblclick",".post.editable",function(){$(this).addClass("editting").children(".subtitle").attr("contenteditable","true");$(this).children("h3").attr("contenteditable","true");$(this).children("ul.short").addClass("editting").children("li:eq(1)").hide()}).on("mousedown",".post:not(.free).editable",function(a){if($(a.target).is("ul.short")||$(a.target).is("ul.short *")||$(a.target).is(".post.editable.editting")||$(a.target).is(".post.editable.editting *")){return}c=0;$(this).addClass("sortable").parents().on("mousemove",function(h){var i=h.clientY;$(".sortable").offset({top:h.clientY-$(".sortable").outerHeight()/2})}).on("mouseup",function(i){if(c==0){var h;if(top>i.clientY){h=$(".posts .post:not(.sortable)").closestToOffset({left:i.clientX,top:i.clientY}).data("z")-1;if(h<0){h=0}}else{h=$(".posts .post:not(.sortable)").closestToOffset({left:i.clientX,top:i.clientY}).data("z")+1}if($(".sortable").data("z")!=$(".posts .post:not(.sortable)").closestToOffset({left:i.clientX,top:i.clientY}).data("z")){post_update($(".sortable").data("id"),"same","same",h)}$(".sortable").css("top","auto");$(".sortable").removeClass("sortable");c=1}return});a.preventDefault()}).on("click",function(a){if(($(".post.new").length>0&&!$(a.target).is(".post.new")&&!$(a.target).is(".post.new *"))&&($(".post.new .subtitle").html()!=""||$(".post.new h3").text().trim()!="")){add_post($(".post.new").offset().left,$(".post.new").offset().top,$(".post.new").css("width").replace("px",""),$(".post.new h3").text().trim(),$(".post.new .subtitle").html(),colorToHex($(".post.new").css("border-bottom-color")).replace("#",""))}else{if(!$(a.target).is(".post.new")&&!$(a.target).is(".post.new *")){$(".post.new").remove()}}});$(document).on("click","ul.short li",function(){if($(this).index()==0){$(this).parent().parent(".post").fadeOut(150,function(){post_delete($(this).data("id"))})}else{$(".post").removeClass("editting").children(".subtitle, h3").attr("contenteditable","false");$(this).hide().parent("ul.short").addClass("editting");$(this).parent().parent(".post").addClass("editting").children(".subtitle").attr("contenteditable","true");$(this).parent().parent(".post").children("h3").attr("contenteditable","true")}});$(document).on("mouseup",".post.editting .subtitle",function(a){$("ul.settings").show().css({top:a.clientY+35,left:a.clientX-100}).children("li")});$.pExec=function(h,a){document.execCommand(h,false,a)};var f=0;var b=0;var e=0;$(document).on("click","ul.settings li",function(i){if($(i.target).is("span.prompt")||$(i.target).is("span.prompt *")){return false}$("ul.settings span.prompt").hide();if($(this).data("obj")){f=0;b=0;e=0;var j=$(this).data("obj"),h;if(j.prompt){h=prompt(j.promptText,j.promptDefault)}else{if(j.arg){h=j.arg}}$.pExec(j.name,h)}else{if($(this).index()==9){b=0;e=0;if(f==0){var a=[];$(this).children().children("span.prompt").show().children("button").click(function(){$(".post.editting .subtitle a").each(function(){a.push($(this).attr("href"))});var m=$(this).siblings("input").val().trim();var l=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;if(!l.test(m)){$(this).siblings("input").val("Geçerli bir link girin.")}else{if(jQuery.inArray(m,a)=="-1"){$(".post.editting .subtitle").append("<br><a href='"+m+"'>"+m+"</a>")}}});f=1}else{$("ul.settings span.prompt").hide();f=0}}else{if($(this).index()==10){f=0;e=0;if(b==0){$("ul.settings > span.prompt").show().click(function(l){if(!$(l.target).is("input")){return false}}).children("input").on("change",function(){var l=new FileReader();if(!$(this).get(0).files[0].type.match("image/jpeg")&&!$(this).get(0).files[0].type.match("image/png")&&!$(this).get(0).files[0].type.match("image/gif")){dialog("Hay aksi!","Lütfen bir resim dosyasý yükle...")}else{l.readAsDataURL($(this).get(0).files[0]);l.onload=function(m){if($(".post.editting .subtitle img").length==0){post_update($(".post.editting").data("id"),"same","same","same","same","same","same",m.target.result);$("ul.settings").hide()}else{dialog("Hay aksi!","Bir paylaþýmýn alt baþlýðýna en fazla bir resim ekleyebilirsiniz... Daha fazla resim eklemek için paylaþýmdan resmi sildikten sonra ekleme yapabilirsiniz.")}}}});b=1}else{$("ul.settings span.prompt").hide();b=0}}else{if($(this).index()==14){f=0;b=0;var k;if(e==0){$(this).children().children("span.prompt").show().children("span").click(function(){if($(".post.editting").length>0){k=$(".post.editting").data("id")}post_update(k,"same","same","same","same","same","same","same",colorToHex($(this).css("background-color")).replace("#",""))});e=1}else{$("ul.settings span.prompt").hide();e=0}}}}}return false});var g=location.pathname.substring(24).replace("/","");if(g){article(g)}window.onpopstate=function(){if(location.pathname.substring(19,23)=="post"){article(location.pathname.substring(24))}else{$("#article").fadeOut(100);document.title=window.title}}});